
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../integration/" rel="prev"/>
<link href="../../kb/git-hash/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.3, mkdocs-material-9.1.11" name="generator"/>
<title>App - Development - Embedded Systems Linux Development Notes</title>
<link href="../../assets/stylesheets/main.85bb2934.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#app-development">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Embedded Systems Linux Development Notes" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Embedded Systems Linux Development Notes">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Embedded Systems Linux Development Notes
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              App - Development
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Embedded Systems Linux Development Notes" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Embedded Systems Linux Development Notes">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Embedded Systems Linux Development Notes
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Overview
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          QEMU variant
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          QEMU variant
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/virtualbox/">
        Host VM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/toolchain/">
        Building a cross-compile toolchain
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/bootloader/">
        Bootloader - U-Boot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/kernel/">
        Linux Kernel
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/tinysystem/">
        Tiny embedded system with BusyBox
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/hardware/">
        Accessing Hardware Devices
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/blockfs/">
        Block Filesystems
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/thirdparty/">
        Third-party libraries and apps
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/buildroot/">
        Buildroot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/appdev/">
        App - Development
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/debugging/">
        App - Remote debug
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../qemu/debootstrap/">
        debootstrap
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          BeagleBone Black variant
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          BeagleBone Black variant
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../virtualbox/">
        Host VM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../toolchain/">
        Building a cross-compile toolchain
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bootloader/">
        Bootloader - U-Boot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../kernel/">
        Linux Kernel
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tinysystem/">
        Tiny embedded system with BusyBox
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hardware/">
        Accessing Hardware Devices
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../blockfs/">
        Block Filesystems
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../thirdparty/">
        Third-party libraries and apps
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../buildroot/">
        Buildroot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../integration/">
        System integration
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          App - Development
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        App - Development
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#objectives">
    Objectives
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#required-tools">
    Required tools
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#setup">
    Setup
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compile-your-own-application">
    Compile your own application
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#enable-debugging-tools">
    Enable debugging tools
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-strace">
    Using strace
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-ltrace">
    Using ltrace
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-gdbserver">
    Using gdbserver
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-mortem-analysis">
    Post mortem analysis
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#visual-studio-code">
    Visual Studio Code
  </a>
<nav aria-label="Visual Studio Code" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#installing-software">
    Installing software
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#accessing-your-board-through-ssh">
    Accessing your board through SSH
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compiling-and-debugging">
    Compiling and debugging
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#profiling-the-application-with-perf">
    Profiling the application with perf
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-to-remember">
    What to remember
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#packaging-with-meson">
    Packaging with Meson
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#backup-and-restore">
    Backup and restore
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#licensing">
    Licensing
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Knowledge Base
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Knowledge Base
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../kb/git-hash/">
        git commit hash expansion
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kb/menuconfig/">
        menuconfig
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kb/processors/">
        Processors
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../copying/">
        Copying this document
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#objectives">
    Objectives
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#required-tools">
    Required tools
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#setup">
    Setup
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compile-your-own-application">
    Compile your own application
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#enable-debugging-tools">
    Enable debugging tools
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-strace">
    Using strace
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-ltrace">
    Using ltrace
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-gdbserver">
    Using gdbserver
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-mortem-analysis">
    Post mortem analysis
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#visual-studio-code">
    Visual Studio Code
  </a>
<nav aria-label="Visual Studio Code" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#installing-software">
    Installing software
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#accessing-your-board-through-ssh">
    Accessing your board through SSH
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compiling-and-debugging">
    Compiling and debugging
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#profiling-the-application-with-perf">
    Profiling the application with perf
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-to-remember">
    What to remember
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#packaging-with-meson">
    Packaging with Meson
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#backup-and-restore">
    Backup and restore
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#licensing">
    Licensing
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="app-development"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.</span> App - Development</h1>
<p><strong>TODO: THIS DOCUMENT IS STILL JUST A DRAFT!</strong></p>
<h2 id="objectives"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.1</span> Objectives</h2>
<ul>
<li>Compile an application against a <em>Buildroot</em> build space and debug it remotely.</li>
</ul>
<h2 id="required-tools"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.2</span> Required tools</h2>
<ul>
<li>
<p>Ubuntu packages:</p>
<p><code>snap</code>
and those from the previous labs.</p>
</li>
<li>
<p><em>snap</em> packages:</p>
<p><code>code</code> (<em>Visual Studio Code</em>)</p>
</li>
<li>
<p>The <em>root</em> filesystem and <em>NFS</em> setup from the <a href="../integration/"><em>integration course</em></a>.</p>
</li>
</ul>
<h2 id="setup"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.3</span> Setup</h2>
<p>We will continue to use the same root filesystem.</p>
<p>Our goal is to compile and debug our own <em>MPD</em> client. This client will be driven by the Nunckuk to switch between audio tracks, and to adjust the playback volume.</p>
<p>However, this client will be used together with mpc, as it won't be able to create the playlist and start the playback. It will just be used to control the volume and switch between songs.
So, you need to run <code>mpc</code> commands first before trying the new client:</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="gp"># </span>mpc<span class="w"> </span>update
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="gp"># </span>mpc<span class="w"> </span>add<span class="w"> </span>/
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="gp"># </span>mpc<span class="w"> </span>pause
</span></code></pre></div>
<p>We will use the new client to resume playback.</p>
<h2 id="compile-your-own-application"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.4</span> Compile your own application</h2>
<p>Go to the <code>$HOME/embedded-linux-bbb-labs/appdev</code> directory.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="gp">$ </span><span class="nv">LAB_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/embedded-linux-bbb-labs/appdev"</span>
</span></code></pre></div>
<p>In the lab directory the file <code>nunchuk-mpd-client.c</code> contains an application which implements a simple <em>MPD</em> client based on the libmpdclient library.
As <em>MPC</em> is also based on this library, <em>Buildroot</em> already compiled it and added it to our <em>root</em> filesystem.
What's special in this application is that it allows to drive music playback through our <em>Nunchuk</em>.</p>
<p><em>Buildroot</em> has generated toolchain wrappers in <code>output/host/bin/</code>, which make it easier to use the toolchain, since these wrappers pass some mandatory flags, especially the <code>--sysroot gcc</code>
flag, which tells <em>GCC</em> where to look for headers and libraries.
This way, we can compile our application outside <em>Buildroot</em>, as often as we want.</p>
<p>Let's add this directory to our <code>PATH</code>, and try to compile the application.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/../integration/buildroot/output/host/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAB_PATH</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="gp">$ </span>arm-linux-gcc<span class="w"> </span>-o<span class="w"> </span>nunchuk-mpd-client<span class="w"> </span>nunchuk-mpd-client.c
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="go">    ...</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="hll"><span class="go">nunchuk-mpd-client.c:(.text+0x28): undefined reference to `mpd_connection_get_error_message'</span>
</span></span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="go">    ...</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="go">collect2: error: ld returned 1 exit status</span>
</span></code></pre></div>
<p>The compiler complains about undefined references to some symbols in <code>libmpdclient</code>.
This is normal, since we didn't tell the compiler to link with this library.<br/>
So, let's use <code>pkg-config</code> to query its database about the list of libraries needed to build an application against <code>libmpdclient</code>. Again, <code>output/host/bin/</code> has a special <code>pkg-config</code> that automatically knows where to look, so it already knows the right paths to find <code>.pc</code> files and their <em>sysroot</em>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="gp">$ </span>arm-linux-gcc<span class="w"> </span>-o<span class="w"> </span>nunchuk-mpd-client<span class="w"> </span>nunchuk-mpd-client.c<span class="w">  </span><span class="se">\</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="gp">    $</span><span class="o">(</span>pkg-config<span class="w"> </span>--libs<span class="w"> </span>libmpdclient<span class="o">)</span>
</span></code></pre></div>
<p>Copy the <code>nunchuk-mpd-client</code> executable to the <code>/root</code> directory of the <em>root</em> filesystem, and
then <em>strip</em> it.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="gp">$ </span><span class="nv">NFSROOT</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/../integration/nfsroot"</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="gp">$ </span>cp<span class="w"> </span>nunchuk-mpd-client<span class="w"> </span><span class="s2">"</span><span class="nv">$NFSROOT</span><span class="s2">/root/"</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="gp">$ </span>arm-linux-strip<span class="w"> </span><span class="s2">"</span><span class="nv">$NFSROOT</span><span class="s2">/root/nunchuk-mpd-client"</span>
</span></code></pre></div>
<p>Back to target system, try to run the program:</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="gp"># </span>/root/nunchuk-mpd-client
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="hll"><span class="go">ERROR: didn't manage to find the Nunchuk device in /dev/input. Is the Nunchuk driver loaded?</span>
</span></span></code></pre></div>
<h2 id="enable-debugging-tools"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.5</span> Enable debugging tools</h2>
<p>In order to debug our application, let's make <em>Buildroot</em> build some debugging tools for our <em>root</em> filesystem.
This is also an opportunity to enable <code>perf</code>, that we are using later on during this lab.</p>
<p>Go back to the <em>Buildroot</em> configuration interface and enable the following options:</p>
<ul>
<li>
<p>In <code>Kernel</code> → <code>Linux Kernel Tools</code>:</p>
<ul>
<li>Enable <code>perf</code>.</li>
</ul>
</li>
<li>
<p>In <code>Target packages</code> → <code>Debugging, profiling and benchmark</code>:</p>
<ul>
<li>Enable <code>ltrace</code>.</li>
<li>Enable <code>strace</code>.</li>
</ul>
</li>
</ul>
<p>Then rebuild and update your <em>root</em> filesystem.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="gp">$ </span><span class="nv">BUILDROOT</span><span class="o">=</span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/../integration/buildroot"</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$BUILDROOT</span>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="gp">$ </span>make<span class="w"> </span>menuconfig
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="gp">$ </span>cp<span class="w"> </span>.config<span class="w"> </span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/buildroot-appdev.config"</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="gp">$ </span>make
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="gp">$ </span>cp<span class="w"> </span>output/images/zImage<span class="w"> </span>/srv/tftp/
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$NFSROOT</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="gp">$ </span>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>*
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="gp">$ </span>tar<span class="w"> </span>xfv<span class="w"> </span><span class="s2">"</span><span class="nv">$BUILDROOT</span><span class="s2">/output/images/rootfs.tar"</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="gp">$ </span>cp<span class="w"> </span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/nunchuk-mpd-client"</span><span class="w"> </span><span class="s2">"</span><span class="nv">$NFSROOT</span><span class="s2">/root/"</span>
</span></code></pre></div>
<h2 id="using-strace"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.6</span> Using strace</h2>
<p>Let's run the program through the <code>strace</code> command to find out why this happens.</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="gp"># </span>strace<span class="w"> </span>/root/nunchuk-mpd-client
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="go">    ...</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="go">openat(AT_FDCWD, "/dev/event0", O_RDONLY) = -1 ENOENT (No such file or directory)</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="go">openat(AT_FDCWD, "/dev/event1", O_RDONLY) = -1 ENOENT (No such file or directory)</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="go">openat(AT_FDCWD, "/dev/event2", O_RDONLY) = -1 ENOENT (No such file or directory)</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="go">openat(AT_FDCWD, "/dev/event3", O_RDONLY) = -1 ENOENT (No such file or directory)</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="go">write(2, "ERROR: didn't manage to find the"..., 93ERROR: didn't manage to find the Nunchuk device in /dev/input. Is the Nunchuk driver loaded?</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="go">) = 93</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="go">exit_group(1)                           = ?</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="go">+++ exited with 1 +++</span>
</span></code></pre></div>
<p>You should see that it's trying to access files that don't exist: it's looking for <code>/dev/event0</code>, while the actual file is at <code>/dev/input/event0</code>!<br/>
So, let's fix the source code from <code>"/dev/%s"</code> to <code>"/dev/input/%s"</code>:</p>
<div class="language-c highlight"><span class="filename">File: nunchuk-mpd-client.c - fixed input device path</span><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="cm">/*...*/</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">argv</span><span class="p">)</span>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="p">{</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">    </span><span class="cm">/*...*/</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">        </span><span class="cm">/* Find Nunchuk input device */</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">        </span><span class="n">ndev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scandir</span><span class="p">(</span><span class="s">"/dev/input"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">namelist</span><span class="p">,</span><span class="w"> </span><span class="n">is_event_device</span><span class="p">,</span><span class="w"> </span><span class="n">alphasort</span><span class="p">);</span>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">    </span><span class="cm">/*...*/</span>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">ndev</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-8-11"><a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">            </span><span class="cm">/*...*/</span>
</span><span id="__span-8-12"><a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="hll"><span class="w">                </span><span class="n">snprintf</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">fname</span><span class="p">),</span><span class="w"> </span><span class="s">"/dev/input/%s"</span><span class="p">,</span><span class="w"> </span><span class="n">namelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">d_name</span><span class="p">);</span>
</span></span><span id="__span-8-13"><a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="w">            </span><span class="cm">/*...*/</span>
</span><span id="__span-8-14"><a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-8-15"><a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="w">    </span><span class="cm">/*...*/</span>
</span><span id="__span-8-16"><a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="p">}</span>
</span><span id="__span-8-17"><a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="cm">/*...*/</span>
</span></code></pre></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAB_PATH</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="gp">$ </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'s|"/dev/%s"|"/dev/input/%s"|'</span><span class="w"> </span>nunchuk-mpd-client.c
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="gp">$ </span>arm-linux-gcc<span class="w">  </span>-o<span class="w"> </span>nunchuk-mpd-client<span class="w">  </span>nunchuk-mpd-client.c<span class="w">  </span><span class="k">$(</span>pkg-config<span class="w"> </span>--libs<span class="w"> </span>libmpdclient<span class="k">)</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="gp">$ </span>cp<span class="w"> </span>nunchuk-mpd-client<span class="w"> </span><span class="s2">"</span><span class="nv">$NFSROOT</span><span class="s2">/root/"</span>
</span></code></pre></div>
<p>Rebuild the program and run it again (no need to <em>strip</em> for our debug sessions):</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="gp"># </span>/root/nunchuk-mpd-client
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="go">ERROR: didn't manage to find the Nunchuk device in /dev/input. Is the Nunchuk driver loaded?</span>
</span></code></pre></div>
<p>Ouch, same problem again!</p>
<p>You can run the program again through <code>strace</code>, and check that the right paths are now accessed, but the cause of the issue might be tricky to find.</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="gp"># </span>strace<span class="w"> </span>/root/nunchuk-mpd-client
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="go">    ...</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="go">openat(AT_FDCWD, "/dev/input/event0", O_RDONLY) = 3</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="go">ioctl(3, EVIOCGNAME(256), "tps65217_pwrbutton\0") = 19</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="go">close(3)                                = 0</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="go">openat(AT_FDCWD, "/dev/input/event1", O_RDONLY) = 3</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="hll"><span class="go">ioctl(3, EVIOCGNAME(256), "Wii Nunchuk\0") = 12</span>
</span></span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="go">close(3)                                = 0</span>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="go">openat(AT_FDCWD, "/dev/input/event2", O_RDONLY) = 3</span>
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="go">ioctl(3, EVIOCGNAME(256), "Logitech Inc. Logitech USB Heads"...) = 57</span>
</span><span id="__span-11-11"><a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="go">close(3)                                = 0</span>
</span><span id="__span-11-12"><a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="go">openat(AT_FDCWD, "/dev/input/event3", O_RDONLY) = 3</span>
</span><span id="__span-11-13"><a href="#__codelineno-11-13" id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="go">ioctl(3, EVIOCGNAME(256), "Logitech Inc. Logitech USB Heads"...) = 40</span>
</span><span id="__span-11-14"><a href="#__codelineno-11-14" id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="go">close(3)                                = 0</span>
</span><span id="__span-11-15"><a href="#__codelineno-11-15" id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="go">write(2, "ERROR: didn't manage to find the"..., 93ERROR: didn't manage to find the Nunchuk device in /dev/input. Is the Nunchuk driver loaded?</span>
</span><span id="__span-11-16"><a href="#__codelineno-11-16" id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="go">) = 93</span>
</span><span id="__span-11-17"><a href="#__codelineno-11-17" id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="go">exit_group(1)                           = ?</span>
</span><span id="__span-11-18"><a href="#__codelineno-11-18" id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="go">+++ exited with 1 +++</span>
</span></code></pre></div>
<p>If you didn't spot the bug, <code>ltrace</code> might help you!</p>
<h2 id="using-ltrace"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.7</span> Using ltrace</h2>
<p>Let's run the program through <code>ltrace</code> now. We will be able to see the shared library calls.
Take your time to study the ltrace output. That's interesting information!
Back to our issue, the last lines of output should make the issue pretty obvious.</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="gp"># </span>ltrace<span class="w"> </span>/root/nunchuk-mpd-client
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="go">    ...</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="go">snprintf("/dev/input/event1", 256, "/dev/input/%s", "event1") = 17</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="go">free(0x49b228)                                   = &lt;void&gt;</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="go">open("/dev/input/event1", 0, 022230010)          = 3</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="go">ioctl(3, -2130688762, 0xbef8fb9c)                = 12</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="hll"><span class="go">strcmp("Wii Nunchuck", "Wii Nunchuk")            = -8</span>
</span></span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="go">close(3)</span>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="go">    ...</span>
</span></code></pre></div>
<p>The <em>for</em> loop within the program should stop at the first instance of a device named <code>"Wii Nunchuck"</code>... and indeed, there are none, because it's called <code>"Wii Nunchuk"</code> instead!
This was clearly a typo, let's fix it!</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAB_PATH</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="gp">$ </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">"s/Nunchuck/Nunchuk/"</span><span class="w"> </span>nunchuk-mpd-client.c
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="gp">$ </span>arm-linux-gcc<span class="w">  </span>-o<span class="w"> </span>nunchuk-mpd-client<span class="w">  </span>nunchuk-mpd-client.c<span class="w">  </span><span class="k">$(</span>pkg-config<span class="w"> </span>--libs<span class="w"> </span>libmpdclient<span class="k">)</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="gp">$ </span>cp<span class="w"> </span>nunchuk-mpd-client<span class="w"> </span><span class="s2">"</span><span class="nv">$NFSROOT</span><span class="s2">/root/"</span>
</span></code></pre></div>
<p>You should now be able to use the new client, driving the server through the following Nunchuk inputs:</p>
<ul>
<li>Joystick up: volume up 5%</li>
<li>Joystick down: volume down 5%</li>
<li>Joystick left: previous song</li>
<li>Joystick right: next song</li>
<li>Z (big) button: pause / play</li>
<li>C (small) button: quit client!</li>
</ul>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="gp"># </span>/root/nunchuk-mpd-client
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="gp"># </span>/root/nunchuk-mpd-client
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="go">Connection successful</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="go">Play/Pause</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="hll"><span class="go">Quit</span>
</span></span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="go">[ 2804.673441] audit: type=1701 audit(1683378416.277:7): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=235 comm="nunchuk-mpd-cli" exe="/root/nunchuk-mpd-client" sig=11 res=1</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="hll"><span class="go">Segmentation fault</span>
</span></span></code></pre></div>
<p>Have fun with the new client. You'll just realize that quitting causes the program to crash with a segmentation fault. Let's debug this too, this time via <code>gdbserver</code>.</p>
<h2 id="using-gdbserver"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.8</span> Using gdbserver</h2>
<p>We are going to use <code>gdbserver</code> to understand why the program segfaults.</p>
<p>Compile <code>nunchuk-mpd-client.c</code> again with the <code>-g</code> (<code>g</code> means <code>gdb</code>) option to include debugging symbols.<br/>
This time, just keep it on your workstation, as you already have the version without debugging symbols on your target.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAB_PATH</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="gp">$ </span>arm-linux-gcc<span class="w">  </span>-g<span class="w">  </span>-o<span class="w"> </span>nunchuk-mpd-client<span class="w">  </span>nunchuk-mpd-client.c<span class="w">  </span><span class="k">$(</span>pkg-config<span class="w"> </span>--libs<span class="w"> </span>libmpdclient<span class="k">)</span>
</span></code></pre></div>
<p>Then, on the target side, run the program under <code>gdbserver</code>. <code>gdbserver</code> will listen on a TCP port for a connection from <code>gdb</code> on the host, and will control the execution of <code>nunchuk-mpd-client</code> according to the <code>gdb</code> commands.</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="gp"># </span>gdbserver<span class="w"> </span>localhost:2345<span class="w"> </span>/root/nunchuk-mpd-client
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="go">Process /root/nunchuk-mpd-client created; pid = 179</span>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="go">Listening on port 2345</span>
</span></code></pre></div>
<p>On the host side, run <code>arm-linux-gdb</code> (also found in your toolchain):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="gp">$ </span>arm-linux-gdb<span class="w"> </span>nunchuk-mpd-client
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="go">GNU gdb (GDB) 11.1</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="go">    ...</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="go">Reading symbols from nunchuk-mpd-client...</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="gp gp-VirtualEnv">(gdb)</span>
</span></code></pre></div>
<p><code>gdb</code> starts and loads the debugging information from the <code>nunchuk-mpd-client</code> binary (in the <code>appdev</code> directory), which was compiled with <code>-g</code>.</p>
<p>Then, we need to tell where to find our libraries, since they are not present in the default <code>/lib/</code> and <code>/usr/lib/</code> directories on your workstation.<br/>
This is done by setting the <code>sysroot</code> variable (on one line; replace <code>&lt;user&gt;</code> with your user name).<br/>
Then, tell <code>gdb</code> to connect to the remote system.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a>(gdb) set sysroot /home/&lt;user&gt;/embedded-linux-bbb-labs/integration/buildroot/output/staging
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>(gdb) target remote 192.168.0.69:2345
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>Remote debugging using 192.168.0.69:2345
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a>Reading symbols from /home/me/embedded-linux-bbb-labs/integration/buildroot/output/staging/lib/ld-linux-armhf.so.3...
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a>0xb6fc88c0 in _start ()
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a>   from /home/me/embedded-linux-bbb-labs/integration/buildroot/output/staging/lib/ld-linux-armhf.so.3
</span></code></pre></div>
<p>Then, use <code>gdb</code> as usual to set breakpoints, look at the source code, run the application step by
step, etc.<br/>
In our case, we'll just start the program and press the <em>C</em> (small) button to quit and trigger the <em>segmentation fault</em>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>(gdb) continue
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>Continiung.
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="hll">Program received signal SIGSEGV, Segmentation fault.
</span></span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>0xb6fb3690 in mpd_settings_free () from /home/me/embedded-linux-bbb-labs/integration/buildroot/output/staging/lib/libmpdclient.so.2
</span></code></pre></div>
<p>After the segmentation fault, you can ask for a backtrace to see where this happened:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a>(gdb) backtrace
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>#0  0xb6fb3690 in mpd_settings_free ()
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>   from /home/me/embedded-linux-bbb-labs/integration/buildroot/output/staging/lib/libmpdclient.so.2
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a>#1  0xb6fa8548 in mpd_connection_free ()
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>   from /home/me/embedded-linux-bbb-labs/integration/buildroot/output/staging/lib/libmpdclient.so.2
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="hll">#2  0x00401300 in main (argc=1, argv=0xbefffe24) at nunchuk-mpd-client.c:167
</span></span></code></pre></div>
<p>This will tell you that the <em>segmentation fault</em> occurred in a function of the <code>libmpdclient</code>, called by our program.<br/>
You will also get the number of the line in the program which caused this. This should help you to find the bug in our application.</p>
<div class="language-c highlight"><span class="filename">File: nunchuk-mpd-client.c</span><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="cm">/*...*/</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">                        </span><span class="k">case</span><span class="w"> </span><span class="no">BTN_C</span><span class="p">:</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">                                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">                                        </span><span class="n">printf</span><span class="p">(</span><span class="s">"Quit</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">                                        </span><span class="n">quit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">                                        </span><span class="n">free</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">                                </span><span class="p">}</span>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">                                </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="cm">/*...*/</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">        </span><span class="cm">/* Close connection */</span>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="hll"><span class="w">        </span><span class="n">mpd_connection_free</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span><span class="w">  </span><span class="cm">/* __LINE__ == 167 */</span>
</span></span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="cm">/*...*/</span>
</span></code></pre></div>
<p>Obviously, the <code>mpd_connection_free()</code> function was provided a pointer to some memory that was already unallocated with <code>free()</code>.<br/>
We're going to fix this bug later on, after learning how to use more tools.</p>
<p>You can now quit <code>gdb</code>.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a>(gdb) quit
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a>A debugging session is active.
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a>        Inferior 1 [process 179] will be killed.
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a>Quit anyway? (y or n) y
</span></code></pre></div>
<h2 id="post-mortem-analysis"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.9</span> Post mortem analysis</h2>
<p>Configure your shell on the <em>target</em> to get a <em>core file</em> dumped when you run <code>nunchuk-mpd-client</code> again.</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="gp"># </span><span class="nb">ulimit</span><span class="w"> </span>-c<span class="w"> </span>unlimited
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="gp"># </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"nunchuk-mpd-client.core"</span><span class="w"> </span>&gt;<span class="w"> </span>/proc/sys/kernel/core_pattern
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="gp"># </span>/root/nunchuk-mpd-client
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="go">Connection successful</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="go">Quit</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="go">[ 1617.932592] audit: type=1701 audit(1683388582.214:2): auid=4294967295 uid=0 gid=0 ses=4294967295 pid=194 comm="nunchuk-mpd-cli" exe="/root/nunchuk-mpd-client" sig=11 res=1</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="hll"><span class="go">Segmentation fault (core dumped)</span>
</span></span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="gp"># </span>du<span class="w"> </span>-h<span class="w"> </span>nunchuk-mpd-client.core*
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="hll"><span class="go">124.0K  nunchuk-mpd-client.core.194</span>
</span></span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="gp"># </span>chmod<span class="w"> </span>a+r<span class="w"> </span>nunchuk-mpd-client.core.194
</span></code></pre></div>
<p>Once you have such a file, inspect it with <code>arm-linux-gdb</code> on the <em>host</em>, set the <code>sysroot</code> setting, and then generate a <em>backtrace</em> to see where the program crashed.<br/>
This way, you can have information about the crash without running the program through the debugger.</p>
<p>Because the executable on the <em>target</em> does not contain debug information (it was compiled without the <code>-g</code> option), and because the core dump holds the <em>absolute paths</em> of the <em>target</em>, we have to emulate the state of the <em>target sysroot</em> somehow.<br/>
One way works by copying the <em>debug</em> executable and the <em>core dump</em> to the corresponding places within the <code>staging</code> folder by <em>Buildroot</em>.<br/>
With <code>set sysroot</code>, <code>gdb</code> sees the debug files as if they were there on the fake <em>target</em>.</p>
<div class="language-text highlight"><span class="filename">Folder structure excerpts to analyze our core dump</span><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>[TARGET]
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>/                                       &lt;&lt;&lt;  host NFS: $NFSROOT
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>├── lib/
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a>|   └── libmpdclient.so.2
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a>└── root/
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a>    ├── nunchuk-mpd-client              &lt;&lt;&lt;  without debug symbols
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a>    └── nunchuk-mpd-client.core.194
</span><span id="__span-24-8"><a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a>
</span><span id="__span-24-9"><a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a>[HOST]
</span><span id="__span-24-10"><a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a>buildroot/output/staging/               &lt;&lt;&lt;  gdb: sysroot
</span><span id="__span-24-11"><a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a>├── lib/
</span><span id="__span-24-12"><a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a>|   └── libmpdclient.so.2
</span><span id="__span-24-13"><a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a>└── root/
</span><span id="__span-24-14"><a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a>    ├── nunchuk-mpd-client              &lt;&lt;&lt;  with debug symbols, copied from: $LAB_PATH/data/
</span><span id="__span-24-15"><a href="#__codelineno-24-15" id="__codelineno-24-15" name="__codelineno-24-15"></a>    └── nunchuk-mpd-client.core.194     &lt;&lt;&lt;  copied from: $NFSROOT/root/
</span></code></pre></div>
<p>Here's the sequence of operations, switching between the shell and <code>gdb</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="s2">"</span><span class="nv">$BUILDROOT</span><span class="s2">/output/staging/root/"</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="gp">$ </span>cp<span class="w"> </span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/nunchuk-mpd-client"</span><span class="w"> </span>./
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="gp">$ </span>cp<span class="w"> </span><span class="s2">"</span><span class="nv">$NFSROOT</span><span class="s2">/root/nunchuk-mpd-client.core.194"</span><span class="w"> </span>./
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="gp">$ </span>arm-linux-gdb<span class="w">  </span>-ex<span class="w"> </span><span class="s2">"set sysroot </span><span class="nv">$BUILDROOT</span><span class="s2">/output/staging"</span>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="go">    ...</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="hll">(gdb) file nunchuk-mpd-client
</span></span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a>Reading symbols from nunchuk-mpd-client...
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="hll">(gdb) core-file nunchuk-mpd-client.core.194
</span></span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a>warning: core file may not match specified executable file.
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a>[New LWP 194]
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a>Core was generated by `/root/nunchuk-mpd-client'.
</span><span id="__span-26-7"><a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a>Program terminated with signal SIGSEGV, Segmentation fault.
</span><span id="__span-26-8"><a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a>#0  0xb6f6c690 in mpd_settings_free ()
</span><span id="__span-26-9"><a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a>   from /home/me/embedded-linux-bbb-labs/appdev/../integration/buildroot/output/staging/lib/libmpdclient.so.2
</span><span id="__span-26-10"><a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="hll">(gdb) backtrace full
</span></span><span id="__span-26-11"><a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a>#0  0xb6f6c690 in mpd_settings_free ()
</span><span id="__span-26-12"><a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a>   from /home/me/embedded-linux-bbb-labs/appdev/../integration/buildroot/output/staging/lib/libmpdclient.so.2
</span><span id="__span-26-13"><a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a>No symbol table info available.
</span><span id="__span-26-14"><a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a>#1  0xb6f61548 in mpd_connection_free ()
</span><span id="__span-26-15"><a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a>   from /home/me/embedded-linux-bbb-labs/appdev/../integration/buildroot/output/staging/lib/libmpdclient.so.2
</span><span id="__span-26-16"><a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a>No symbol table info available.
</span><span id="__span-26-17"><a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a>#2  0x00421300 in main (argc=1, argv=0xbea46e24) at nunchuk-mpd-client.c:167
</span><span id="__span-26-18"><a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a>        conn = 0x4331c0
</span><span id="__span-26-19"><a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a>        i = 1
</span><span id="__span-26-20"><a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a>        ndev = 4
</span><span id="__span-26-21"><a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a>        ret = 16
</span><span id="__span-26-22"><a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a>        fd = 3
</span><span id="__span-26-23"><a href="#__codelineno-26-23" id="__codelineno-26-23" name="__codelineno-26-23"></a>        quit = 1
</span><span id="__span-26-24"><a href="#__codelineno-26-24" id="__codelineno-26-24" name="__codelineno-26-24"></a>        num_events = 1
</span><span id="__span-26-25"><a href="#__codelineno-26-25" id="__codelineno-26-25" name="__codelineno-26-25"></a>        event = {time = {tv_sec = 1683388582, tv_usec = 224672}, type = 1, code = 306, value = 1}
</span><span id="__span-26-26"><a href="#__codelineno-26-26" id="__codelineno-26-26" name="__codelineno-26-26"></a>        namelist = 0x43b1b
</span><span id="__span-26-27"><a href="#__codelineno-26-27" id="__codelineno-26-27" name="__codelineno-26-27"></a>(gdb) set confirm off
</span><span id="__span-26-28"><a href="#__codelineno-26-28" id="__codelineno-26-28" name="__codelineno-26-28"></a>(gdb) quit
</span></code></pre></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="s2">"</span><span class="nv">$BUILDROOT</span><span class="s2">/output/staging/root/"</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="gp">$ </span>rm<span class="w"> </span>nunchuk-mpd-client*
</span></code></pre></div>
<p>You can even see the value of all variables in the different function contexts of your program.
This way, you can have a lot of information about the crash without running the program
through the debugger.</p>
<h2 id="visual-studio-code"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.10</span> Visual Studio Code</h2>
<h3 id="installing-software"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.10.1</span> Installing software</h3>
<p>We are going to use <em>Visual Studio Code</em> to do the remote debugging again, and eventually fix and recompile our program.</p>
<p>The first thing to do is install <em>VSC</em>. This package is only available as a <em>snap package</em>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>snap
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="gp">$ </span>sudo<span class="w"> </span>snap<span class="w"> </span>install<span class="w"> </span>--classic<span class="w"> </span>code
</span></code></pre></div>
<h3 id="accessing-your-board-through-ssh"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.10.2</span> Accessing your board through SSH</h3>
<p>We will use <em>Visual Studio Code</em> to modify and recompile our client program, and also to update and run the binary on the target.
Of course, we will use a simple solution, as we won't be able to spend too much time learning about all the possibilities offered by <em>VSC</em>.</p>
<p>For our purpose, a good solution is <em>SSH</em>, which allows to copy files (via the <code>scp</code> command) and to run remote commands.
We already included the <em>Dropbear</em> SSH server in our <em>root</em> filesystem.</p>
<p>We just need to implement password-less SSH access, to keep things simple:</p>
<p>Generate a password-less one with the <code>ssh-keygen</code> command, named <code>id_rsa_empty</code>.<br/>
We're creating two files in <code>~/.ssh/</code>: <code>id_rsa_empty</code> (<em>private</em> key) and <code>id_rsa_empty.pub</code> (<em>public</em> key).</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="gp">$ </span>ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa<span class="w"> </span>-f<span class="w"> </span>~/.ssh/id_rsa_empty
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="go">Generating public/private rsa key pair.</span>
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="hll"><span class="go">Enter passphrase (empty for no passphrase):</span>
</span></span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="go">Enter same passphrase again:</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="hll"><span class="go">Your identification has been saved in /home/me/.ssh/id_rsa_empty</span>
</span></span><span id="__span-29-6"><a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="hll"><span class="go">Your public key has been saved in /home/me/.ssh/id_rsa_empty.pub</span>
</span></span><span id="__span-29-7"><a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="go">The key fingerprint is:</span>
</span><span id="__span-29-8"><a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="go">SHA256:MMNVi/JBFlFTv6DpuCpx6zj/WGceGDr7Q6k0ThcBUqo me@vm</span>
</span><span id="__span-29-9"><a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="go">    ...</span>
</span></code></pre></div>
<p>Then, create the <code>/root/.ssh/</code> directory on the <em>target</em>, and in it create an <code>authorized_keys</code> file with the line in <code>id_rsa_empty.pub</code>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="gp"># </span>sudo<span class="w"> </span>chmod<span class="w"> </span>-R<span class="w"> </span>a+rwx<span class="w"> </span><span class="s2">"</span><span class="nv">$NFSROOT</span><span class="s2">/root/"</span>
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="s2">"</span><span class="nv">$NFSROOT</span><span class="s2">/root/"</span>
</span><span id="__span-30-3"><a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>.ssh/
</span><span id="__span-30-4"><a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="gp">$ </span>cat<span class="w"> </span>~/.ssh/id_rsa_empty.pub<span class="w"> </span>&gt;<span class="w"> </span>.ssh/authorized_keys
</span></code></pre></div>
<p>Finally, fix permissions on the <em>target</em>, as <em>Dropbear</em> is quite strict about them:</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="gp"># </span>chmod<span class="w"> </span>-R<span class="w"> </span>go-rwx<span class="w"> </span>/root
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="gp"># </span>chown<span class="w"> </span>-R<span class="w"> </span>root.root<span class="w"> </span>/root
</span></code></pre></div>
<p>Then, you can test that SSH works without a password:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="gp">$ </span>ssh<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa_empty<span class="w"> </span>root@192.168.0.69
</span></code></pre></div>
<p>If you face trouble, you can check the <em>Dropbear</em> logs on the <em>target</em> (<span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-c">C</kbd></span> to exit <code>journalctl</code>).<br/>
For example, here we once tried to connect with the wrong <em>SSH identity</em>, then we retied with the authorized one:</p>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="gp"># </span>journalctl<span class="w"> </span>-fu<span class="w"> </span>dropbear
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="go">May 06 19:13:21 buildroot dropbear[179]: Child connection from 192.168.0.15:48928</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="hll"><span class="go">May 06 19:13:22 buildroot dropbear[179]: User account 'root' is locked</span>
</span></span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="go">May 06 19:13:24 buildroot dropbear[179]: Exit before auth from &lt;192.168.0.15:48928&gt;: (user 'root', 1 fails): Exited normally</span>
</span><span id="__span-33-5"><a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="go">May 06 19:22:39 buildroot dropbear[190]: Child connection from 192.168.0.15:46688</span>
</span><span id="__span-33-6"><a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="hll"><span class="go">May 06 19:22:40 buildroot dropbear[190]: Pubkey auth succeeded for 'root' with key sha1!! 12:f0:db:23:34:dc:60:f1:7a:1a:d5:0c:f8:a2:dc:aa:37:97:36:0e from 192.168.0.15:46688</span>
</span></span></code></pre></div>
<h3 id="compiling-and-debugging"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.10.3</span> Compiling and debugging</h3>
<p>The <code>appdev/</code> lab directory already contains a <code>prep-debug.sh</code> script and a <code>.vscode/</code> directory with ready made settings for code editing and for compiling and debugging our application.</p>
<p>Here are these files:</p>
<ul>
<li><code>prep-debug.sh</code>: script to recompile the program, copy it to the <em>target</em> through SSH, and start it through the debugger.<br/>
  Open this file and update the <em>target</em> IP and path settings if necessary.<br/>
  Since we're using a custom <em>SSH identity</em>, add <code>-i ~/.ssh/id_rsa_empty</code> to the SSH commands (<code>ssh</code> and <code>scp</code>).<br/>
  The result should look like:</li>
</ul>
<div class="language-sh highlight"><span class="filename">File: prep-debug.sh - adapted to this lab</span><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="ch">#!/bin/sh</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a>
</span><span id="__span-34-3"><a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="c1"># Definitions</span>
</span><span id="__span-34-4"><a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="nv">TARGETIP</span><span class="o">=</span><span class="s2">"192.168.0.69"</span>
</span><span id="__span-34-5"><a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/embedded-linux-bbb-labs/integration/buildroot/output/host/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</span><span id="__span-34-6"><a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="nv">EXEC</span><span class="o">=</span>nunchuk-mpd-client
</span><span id="__span-34-7"><a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="nv">CROSS_COMPILE</span><span class="o">=</span>arm-linux-
</span><span id="__span-34-8"><a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="nv">SSHID</span><span class="o">=</span><span class="s2">"~/.ssh/id_rsa_empty"</span>
</span><span id="__span-34-9"><a href="#__codelineno-34-9" id="__codelineno-34-9" name="__codelineno-34-9"></a>
</span><span id="__span-34-10"><a href="#__codelineno-34-10" id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="c1"># Rebuild executable</span>
</span><span id="__span-34-11"><a href="#__codelineno-34-11" id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="si">${</span><span class="nv">CROSS_COMPILE</span><span class="si">}</span>gcc<span class="w"> </span>-g<span class="w"> </span>-o<span class="w"> </span><span class="nv">$EXEC</span><span class="w"> </span><span class="nv">$EXEC</span>.c<span class="w"> </span><span class="k">$(</span>pkg-config<span class="w"> </span>--libs<span class="w"> </span>--cflags<span class="w"> </span>libmpdclient<span class="k">)</span>
</span><span id="__span-34-12"><a href="#__codelineno-34-12" id="__codelineno-34-12" name="__codelineno-34-12"></a>
</span><span id="__span-34-13"><a href="#__codelineno-34-13" id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="c1"># Kill gdbserver on the target</span>
</span><span id="__span-34-14"><a href="#__codelineno-34-14" id="__codelineno-34-14" name="__codelineno-34-14"></a>ssh<span class="w"> </span>-i<span class="w"> </span><span class="nv">$SSHID</span><span class="w"> </span>root@<span class="nv">$TARGETIP</span><span class="w"> </span>killall<span class="w"> </span>gdbserver
</span><span id="__span-34-15"><a href="#__codelineno-34-15" id="__codelineno-34-15" name="__codelineno-34-15"></a>
</span><span id="__span-34-16"><a href="#__codelineno-34-16" id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="c1"># Copy over new executable</span>
</span><span id="__span-34-17"><a href="#__codelineno-34-17" id="__codelineno-34-17" name="__codelineno-34-17"></a>scp<span class="w"> </span>-i<span class="w"> </span><span class="nv">$SSHID</span><span class="w"> </span><span class="nv">$EXEC</span><span class="w"> </span>root@<span class="nv">$TARGETIP</span>:/root/
</span><span id="__span-34-18"><a href="#__codelineno-34-18" id="__codelineno-34-18" name="__codelineno-34-18"></a>
</span><span id="__span-34-19"><a href="#__codelineno-34-19" id="__codelineno-34-19" name="__codelineno-34-19"></a><span class="c1"># Start gdbserver on the target</span>
</span><span id="__span-34-20"><a href="#__codelineno-34-20" id="__codelineno-34-20" name="__codelineno-34-20"></a>ssh<span class="w"> </span>-i<span class="w"> </span><span class="nv">$SSHID</span><span class="w"> </span>-n<span class="w"> </span>-f<span class="w"> </span>root@<span class="nv">$TARGETIP</span><span class="w"> </span><span class="s2">"sh -c 'nohup gdbserver localhost:2345 /root/nunchuk-mpd-client &gt; /dev/null 2&gt;&amp;1 &amp;'"</span>
</span></code></pre></div>
<ul>
<li>
<p><code>.vscode/c_cpp_properties.json</code>: settings for the code editor.<br/>
  Modify the paths in this file according to your setup.</p>
</li>
<li>
<p><code>.vscode/tasks.json</code>: definition of a <code>build</code> task, calling the <code>prep-debug.sh</code> script.</p>
</li>
<li>
<p><code>.vscode/launch.json</code>: these are the settings for remote debugging.<br/>
  Again, open this file, update the paths, and the <em>target</em> IP address if necessary.</p>
</li>
</ul>
<p>Start <em>Visual Studio Code</em>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="gp">$ </span>code
</span></code></pre></div>
<p>Use <code>File</code> → <code>Open Folder</code> to open the <code>appdev/</code> directory.</p>
<p>The first thing to do is to make sure the <em>C/C++ extension</em> from <em>Microsoft</em> (<code>ms-vscode.cpptools</code>) is installed.
Do this using the <em>Extensions</em> vertical tab.</p>
<p>Then click on the <code>nunchuk-mpd-client.c</code> file in the left column to open it in <em>VSC</em>.</p>
<p>Now, start by compiling your program from <em>VSC</em>, copying it to the <em>target</em>, and running it through the debugger by using the <code>Terminal</code> → <code>Run Build Task...</code> menu entry.</p>
<p>Last but not least, you can start debugging the program by clicking on the <code>Run and Debug</code> tab, and then on the <code>gdb (Launch)</code> at the top.</p>
<p>In the debug console, you should see that debugging has started.
The bottom line of the interface should turn orange too.</p>
<p>Then, start using the <em>Nunchuk</em> to control playback, and when you try to quit with the <em>C</em> button, <em>VSC</em> should now see the <em>segmentation fault</em>.</p>
<p>You can then look at variables, the call stack, browse the code, <em>et cetera</em>...</p>
<p>To stop debugging, you should use <code>Run</code> → <code>Stop Debugging</code>.</p>
<p>By studing the the code, you should eventually find that what's causing the <em>segmentation fault</em> is the call to <code>free()</code> in the test for the <em>C</em> button.<br/>
Remove this line, save the file through the <code>File</code> menu (otherwise nothing will change), and then compile and run the application again.<br/>
This time, there should be no more <em>segmentation fault</em> when you hit the <em>C</em> button.</p>
<p>If you are ahead of time, don't hesitate to spend more time with <em>VSC</em>, for example to add breakpoints and execute the program step-by-step.</p>
<h2 id="profiling-the-application-with-perf"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.11</span> Profiling the application with perf</h2>
<p>Let's connect to the <em>target</em> via SSH for the best user experience.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-36-1"><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="gp">$ </span>ssh<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa_empty<span class="w"> </span>root@192.168.0.69
</span></code></pre></div>
<p>Let's make a quick attempt at profiling our application with the <code>perf</code> command:</p>
<div class="language-console highlight"><span class="filename">ssh - systemd</span><pre><span></span><code><span id="__span-37-1"><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="gp"># </span>perf<span class="w"> </span>record<span class="w"> </span>/root/nunchuk-mpd-client
</span></code></pre></div>
<p>Use your application and leave it when you are done.</p>
<p>This stores profiling data in a <code>perf.data</code> file.
One way to extract information from it is to run the below command in the same directory (the one containing <code>perf.data</code>):</p>
<div class="language-console highlight"><span class="filename">ssh - systemd</span><pre><span></span><code><span id="__span-38-1"><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="gp"># </span>perf<span class="w"> </span>report
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a># To display the perf.data header info, please use --header/--header-only options.
</span><span id="__span-39-2"><a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a>#
</span><span id="__span-39-3"><a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a>#
</span><span id="__span-39-4"><a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a># Total Lost Samples: 0
</span><span id="__span-39-5"><a href="#__codelineno-39-5" id="__codelineno-39-5" name="__codelineno-39-5"></a>#
</span><span id="__span-39-6"><a href="#__codelineno-39-6" id="__codelineno-39-6" name="__codelineno-39-6"></a># Samples: 43  of event 'cycles'
</span><span id="__span-39-7"><a href="#__codelineno-39-7" id="__codelineno-39-7" name="__codelineno-39-7"></a># Event count (approx.): 8939291
</span><span id="__span-39-8"><a href="#__codelineno-39-8" id="__codelineno-39-8" name="__codelineno-39-8"></a>#
</span><span id="__span-39-9"><a href="#__codelineno-39-9" id="__codelineno-39-9" name="__codelineno-39-9"></a># Overhead  Command          Shared Object        Symbol
</span><span id="__span-39-10"><a href="#__codelineno-39-10" id="__codelineno-39-10" name="__codelineno-39-10"></a># ........  ...............  ...................  ...............................
</span><span id="__span-39-11"><a href="#__codelineno-39-11" id="__codelineno-39-11" name="__codelineno-39-11"></a>#
</span><span id="__span-39-12"><a href="#__codelineno-39-12" id="__codelineno-39-12" name="__codelineno-39-12"></a>     5.75%  nunchuk-mpd-cli  ld-linux-armhf.so.3  [.] _dl_relocate_object
</span><span id="__span-39-13"><a href="#__codelineno-39-13" id="__codelineno-39-13" name="__codelineno-39-13"></a>     5.57%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] getname_flags
</span><span id="__span-39-14"><a href="#__codelineno-39-14" id="__codelineno-39-14" name="__codelineno-39-14"></a>     5.47%  nunchuk-mpd-cli  ld-linux-armhf.so.3  [.] strcmp
</span><span id="__span-39-15"><a href="#__codelineno-39-15" id="__codelineno-39-15" name="__codelineno-39-15"></a>     5.35%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] __mutex_init
</span><span id="__span-39-16"><a href="#__codelineno-39-16" id="__codelineno-39-16" name="__codelineno-39-16"></a>     5.33%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] __fsnotify_inode_delete
</span><span id="__span-39-17"><a href="#__codelineno-39-17" id="__codelineno-39-17" name="__codelineno-39-17"></a>     4.80%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] _raw_spin_lock
</span><span id="__span-39-18"><a href="#__codelineno-39-18" id="__codelineno-39-18" name="__codelineno-39-18"></a>     4.72%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] down_read_trylock
</span><span id="__span-39-19"><a href="#__codelineno-39-19" id="__codelineno-39-19" name="__codelineno-39-19"></a>     4.56%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] _raw_spin_unlock_irqrestore
</span><span id="__span-39-20"><a href="#__codelineno-39-20" id="__codelineno-39-20" name="__codelineno-39-20"></a>     3.86%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] next_uptodate_page
</span><span id="__span-39-21"><a href="#__codelineno-39-21" id="__codelineno-39-21" name="__codelineno-39-21"></a>     3.72%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] queue_work_on
</span><span id="__span-39-22"><a href="#__codelineno-39-22" id="__codelineno-39-22" name="__codelineno-39-22"></a>     3.67%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] release_pages
</span><span id="__span-39-23"><a href="#__codelineno-39-23" id="__codelineno-39-23" name="__codelineno-39-23"></a>     3.24%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] __anon_vma_prepare
</span><span id="__span-39-24"><a href="#__codelineno-39-24" id="__codelineno-39-24" name="__codelineno-39-24"></a>     3.24%  nunchuk-mpd-cli  ld-linux-armhf.so.3  [.] _dl_name_match_p
</span><span id="__span-39-25"><a href="#__codelineno-39-25" id="__codelineno-39-25" name="__codelineno-39-25"></a>     2.83%  nunchuk-mpd-cli  ld-linux-armhf.so.3  [.] do_lookup_x
</span><span id="__span-39-26"><a href="#__codelineno-39-26" id="__codelineno-39-26" name="__codelineno-39-26"></a>     2.82%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] do_page_fault
</span><span id="__span-39-27"><a href="#__codelineno-39-27" id="__codelineno-39-27" name="__codelineno-39-27"></a>     2.82%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] v7_flush_icache_all
</span><span id="__span-39-28"><a href="#__codelineno-39-28" id="__codelineno-39-28" name="__codelineno-39-28"></a>     2.81%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] __audit_syscall_exit
</span><span id="__span-39-29"><a href="#__codelineno-39-29" id="__codelineno-39-29" name="__codelineno-39-29"></a>     2.81%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] xas_find
</span><span id="__span-39-30"><a href="#__codelineno-39-30" id="__codelineno-39-30" name="__codelineno-39-30"></a>     2.80%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] tcp_write_xmit
</span><span id="__span-39-31"><a href="#__codelineno-39-31" id="__codelineno-39-31" name="__codelineno-39-31"></a>     2.80%  nunchuk-mpd-cli  libc.so.6            [.] getenv
</span><span id="__span-39-32"><a href="#__codelineno-39-32" id="__codelineno-39-32" name="__codelineno-39-32"></a>     2.80%  nunchuk-mpd-cli  libc.so.6            [.] strlen
</span><span id="__span-39-33"><a href="#__codelineno-39-33" id="__codelineno-39-33" name="__codelineno-39-33"></a>     2.56%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] expand_downwards
</span><span id="__span-39-34"><a href="#__codelineno-39-34" id="__codelineno-39-34" name="__codelineno-39-34"></a>     2.07%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] core_sys_select
</span><span id="__span-39-35"><a href="#__codelineno-39-35" id="__codelineno-39-35" name="__codelineno-39-35"></a>     2.07%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] syscall_trace_exit
</span><span id="__span-39-36"><a href="#__codelineno-39-36" id="__codelineno-39-36" name="__codelineno-39-36"></a>     2.07%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] vfs_write
</span><span id="__span-39-37"><a href="#__codelineno-39-37" id="__codelineno-39-37" name="__codelineno-39-37"></a>     1.86%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] mark_page_accessed
</span><span id="__span-39-38"><a href="#__codelineno-39-38" id="__codelineno-39-38" name="__codelineno-39-38"></a>     1.86%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] skb_unlink
</span><span id="__span-39-39"><a href="#__codelineno-39-39" id="__codelineno-39-39" name="__codelineno-39-39"></a>     1.86%  nunchuk-mpd-cli  libc.so.6            [.] __fdelt_warn
</span><span id="__span-39-40"><a href="#__codelineno-39-40" id="__codelineno-39-40" name="__codelineno-39-40"></a>     1.75%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] __flush_work
</span><span id="__span-39-41"><a href="#__codelineno-39-41" id="__codelineno-39-41" name="__codelineno-39-41"></a>     1.70%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] tcp_ack
</span><span id="__span-39-42"><a href="#__codelineno-39-42" id="__codelineno-39-42" name="__codelineno-39-42"></a>     0.37%  nunchuk-mpd-cli  [kernel.kallsyms]    [k] set_cred_ucounts
</span><span id="__span-39-43"><a href="#__codelineno-39-43" id="__codelineno-39-43" name="__codelineno-39-43"></a>     0.06%  perf-exec        [kernel.kallsyms]    [k] perf_event_exec
</span><span id="__span-39-44"><a href="#__codelineno-39-44" id="__codelineno-39-44" name="__codelineno-39-44"></a>
</span><span id="__span-39-45"><a href="#__codelineno-39-45" id="__codelineno-39-45" name="__codelineno-39-45"></a>
</span><span id="__span-39-46"><a href="#__codelineno-39-46" id="__codelineno-39-46" name="__codelineno-39-46"></a>#
</span><span id="__span-39-47"><a href="#__codelineno-39-47" id="__codelineno-39-47" name="__codelineno-39-47"></a># (Cannot load tips.txt file, please install perf!)
</span><span id="__span-39-48"><a href="#__codelineno-39-48" id="__codelineno-39-48" name="__codelineno-39-48"></a>#
</span><span id="__span-39-49"><a href="#__codelineno-39-49" id="__codelineno-39-49" name="__codelineno-39-49"></a>
</span><span id="__span-39-50"><a href="#__codelineno-39-50" id="__codelineno-39-50" name="__codelineno-39-50"></a>~
</span></code></pre></div>
<p>See the time spent in various kernel (<code>[k]</code>) and userspace (<code>[.]</code>) functions.</p>
<p>Now, let's profile the whole system.<br/>
First, make sure that the system is currently playing audio.<br/>
Then SSH to your board and run <code>perf top</code> (working better through SSH) to see live information about kernel and userspace functions consuming most CPU time.</p>
<p>This is interactive, but hard to analyze. You can also run <code>perf record</code> for about 30 seconds, followed by <code>perf report</code> to have a useful summary of system wide activity for a substantial amount of time.</p>
<p>This was a very brief start at practising with <code>perf</code>, which offers many more possibilities than we could see here.</p>
<h2 id="what-to-remember"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.12</span> What to remember</h2>
<p>During this lab, we learned that...</p>
<ul>
<li>
<p>It's easy to study the behavior of programs and diagnose issues without even having the source code, thanks to strace, ltrace and perf.</p>
</li>
<li>
<p>You can use <code>perf</code> as a system wide profiler too.</p>
</li>
<li>
<p>You can leave a small <code>gdbserver</code> program (about 400 KB) on your <em>target</em> that allows to debug target applications, using a standard <code>gdb</code> debugger on the development <em>host</em>, or a graphical IDE such as <em>Visual Studio Code</em>.</p>
</li>
<li>
<p>It is fine to <em>strip</em> applications and binaries on the <em>target</em> machine, as long as the programs and libraries with debugging symbols are available on the development <em>host</em>.</p>
</li>
<li>
<p>Thanks to <em>core dumps</em>, you can know where a program crashed, without having to reproduce the issue by running the program through the debugger.</p>
</li>
</ul>
<h2 id="packaging-with-meson"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.13</span> Packaging with Meson</h2>
<p>Now that our application is ready, the next thing to do is to properly integrate it into our root filesystem.
This is a nice opportunity to see how to do this with <em>Meson</em> and leverage <em>Buildroot</em>'s infrastructure to cross-compile <em>Meson</em> based packages.</p>
<p>Still in the main <code>appdev/</code> directory, create a <code>nunchuk-mpd-client-1.0/</code> directory and copy the <code>nunchuk-mpd-client.c</code> file to it.
In this new directory, all you have to do is create a very simple <code>meson.build</code> file.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-40-1"><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/nunchuk-mpd-client-1.0/"</span>
</span><span id="__span-40-2"><a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$_</span>
</span><span id="__span-40-3"><a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="gp">$ </span>cp<span class="w"> </span>../nunchuk-mpd-client.c<span class="w"> </span>.
</span><span id="__span-40-4"><a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="gp">$ </span>nano<span class="w"> </span>meson.build
</span></code></pre></div>
<div class="language-js highlight"><span class="filename">File: meson.build</span><pre><span></span><code><span id="__span-41-1"><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="nx">project</span><span class="p">(</span><span class="s1">'nunchuk-mpd-client'</span><span class="p">,</span><span class="w"> </span><span class="s1">'c'</span><span class="p">,</span><span class="w"> </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s1">'1.0'</span><span class="p">)</span>
</span><span id="__span-41-2"><a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="nx">libmpdclient_dep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dependency</span><span class="p">(</span><span class="s1">'libmpdclient'</span><span class="p">,</span><span class="w"> </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s1">'&gt;= 2.16'</span><span class="p">)</span>
</span><span id="__span-41-3"><a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="nx">executable</span><span class="p">(</span><span class="s1">'nunchuk-mpd-client'</span><span class="p">,</span><span class="w"> </span><span class="s1">'nunchuk-mpd-client.c'</span><span class="p">,</span>
</span><span id="__span-41-4"><a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">           </span><span class="nx">dependencies</span><span class="o">:</span><span class="w"> </span><span class="nx">libmpdclient_dep</span><span class="p">,</span><span class="w"> </span><span class="nx">install</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</span></code></pre></div>
<p>Note that <code>install: true</code> is necessary to get the executable installed by <code>ninja install</code>.</p>
<p>Now, the next thing is to add a new <em>package</em> to the <em>Buildroot</em> source tree.</p>
<p>Create a <code>nunchuk-mpd-client</code> directory under <code>package/</code>.
In this directory, create a <code>Config.in</code> file. You can reuse the one from the <code>mpd-mpc</code> package (the <code>mpc</code> client) which also depends on <code>libmpdclient</code>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-42-1"><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">"</span><span class="nv">$BUILDROOT</span><span class="s2">/package/nunchuk-mpd-client/"</span>
</span><span id="__span-42-2"><a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$_</span>
</span><span id="__span-42-3"><a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="gp">$ </span>cp<span class="w"> </span>../mpd-mpc/Config.in<span class="w"> </span>.
</span><span id="__span-42-4"><a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="gp">$ </span>nano<span class="w"> </span>Config.in
</span></code></pre></div>
<div class="language-kconfig highlight"><span class="filename">File: Config.in</span><pre><span></span><code><span id="__span-43-1"><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="k">config</span><span class="w"> </span>BR2_PACKAGE_NUNCHUK_MPD_CLIENT
</span><span id="__span-43-2"><a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="w">        </span><span class="nb">bool</span><span class="w"> </span><span class="s2">"nunchuk-mpd-client"</span>
</span><span id="__span-43-3"><a href="#__codelineno-43-3" id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">        </span><span class="k">select</span><span class="w"> </span>BR2_PACKAGE_LIBMPDCLIENT
</span><span id="__span-43-4"><a href="#__codelineno-43-4" id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">        </span><span class="k">help</span>
</span><span id="__span-43-5"><a href="#__codelineno-43-5" id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="sd">          A minimalist Nintendo Nunchuk interface to MPD.</span>
</span><span id="__span-43-6"><a href="#__codelineno-43-6" id="__codelineno-43-6" name="__codelineno-43-6"></a>
</span><span id="__span-43-7"><a href="#__codelineno-43-7" id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="sd">          https://bootlin.com/doc/training/embedded-linux-bbb/</span>
</span></code></pre></div>
<p>Modify <code>package/Config.in</code> to source this new file in the <code>Audio and video applications</code> submenu.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-44-1"><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="gp">$ </span>nano<span class="w"> </span>../Config.in
</span></code></pre></div>
<div class="language-kconfig highlight"><span class="filename">File: package/Config.in - added package</span><pre><span></span><code><span id="__span-45-1"><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="w">    </span>...
</span><span id="__span-45-2"><a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="k">menu</span><span class="w"> </span><span class="s2">"Audio and video applications"</span>
</span><span id="__span-45-3"><a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="w">    </span>...
</span><span id="__span-45-4"><a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">        </span><span class="k">source</span><span class="w"> </span><span class="s2">"package/musepack/Config.in"</span>
</span><span id="__span-45-5"><a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="w">        </span><span class="k">source</span><span class="w"> </span><span class="s2">"package/ncmpc/Config.in"</span>
</span><span id="__span-45-6"><a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="hll"><span class="w">        </span><span class="k">source</span><span class="w"> </span><span class="s2">"package/nunchuk-mpd-client/Config.in"</span>
</span></span><span id="__span-45-7"><a href="#__codelineno-45-7" id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="w">        </span><span class="k">source</span><span class="w"> </span><span class="s2">"package/omxplayer/Config.in"</span>
</span><span id="__span-45-8"><a href="#__codelineno-45-8" id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="w">        </span><span class="k">source</span><span class="w"> </span><span class="s2">"package/on2-8170-libs/Config.in"</span>
</span><span id="__span-45-9"><a href="#__codelineno-45-9" id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="w">    </span>...
</span></code></pre></div>
<p>Last but not least, create the <code>nunchuk-mpd-client.mk</code>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-46-1"><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="gp">$ </span>nano<span class="w"> </span>nunchuk-mpd-client.mk
</span></code></pre></div>
<div class="language-make highlight"><span class="filename">File: nunchuk-mpd-client.mk</span><pre><span></span><code><span id="__span-47-1"><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="nv">NUNCHUK_MPD_CLIENT_VERSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>.0
</span><span id="__span-47-2"><a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="nv">NUNCHUK_MPD_CLIENT_SITE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">$(</span>HOME<span class="k">)</span>/embedded-linux-bbb-labs/appdev/nunchuk-mpd-client-1.0
</span><span id="__span-47-3"><a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="nv">NUNCHUK_MPD_CLIENT_SITE_METHOD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">local</span>
</span><span id="__span-47-4"><a href="#__codelineno-47-4" id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="nv">NUNCHUK_MPD_CLIENT_DEPENDENCIES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>host-pkgconf<span class="w"> </span>libmpdclient
</span><span id="__span-47-5"><a href="#__codelineno-47-5" id="__codelineno-47-5" name="__codelineno-47-5"></a>
</span><span id="__span-47-6"><a href="#__codelineno-47-6" id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="k">$(</span><span class="nv">eval</span> <span class="k">$(</span><span class="nv">meson-package</span><span class="k">))</span>
</span></code></pre></div>
<p>All you have to do now is to enable the <code>nunchuk-mpd-client</code> package in <em>Buildroot</em>'s configuration, run <code>make</code>, update the <em>root</em> filesystem and check on the <em>target</em> that <code>/usr/bin/nunchuk-mpd-client</code> exists and runs fine.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-48-1"><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$BUILDROOT</span>
</span><span id="__span-48-2"><a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="gp">$ </span>make<span class="w"> </span>menuconfig
</span><span id="__span-48-3"><a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="gp">$ </span>cp<span class="w"> </span>.config<span class="w"> </span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/buildroot-nunchuk-mpd-client.config"</span>
</span><span id="__span-48-4"><a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="gp">$ </span>make
</span><span id="__span-48-5"><a href="#__codelineno-48-5" id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="gp">$ </span>cp<span class="w"> </span>output/images/zImage<span class="w"> </span>/srv/tftp/
</span><span id="__span-48-6"><a href="#__codelineno-48-6" id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$NFSROOT</span>
</span><span id="__span-48-7"><a href="#__codelineno-48-7" id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="gp">$ </span>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>*
</span><span id="__span-48-8"><a href="#__codelineno-48-8" id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="gp">$ </span>tar<span class="w"> </span>xfv<span class="w"> </span><span class="s2">"</span><span class="nv">$BUILDROOT</span><span class="s2">/output/images/rootfs.tar"</span>
</span></code></pre></div>
<div class="language-console highlight"><span class="filename">picocomBBB - systemd</span><pre><span></span><code><span id="__span-49-1"><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="gp"># </span>reboot
</span><span id="__span-49-2"><a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="go">    ...</span>
</span><span id="__span-49-3"><a href="#__codelineno-49-3" id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="gp"># </span>which<span class="w"> </span>nunchuk-mpd-client
</span><span id="__span-49-4"><a href="#__codelineno-49-4" id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="go">/usr/bin/nunchuk-mpd-client</span>
</span><span id="__span-49-5"><a href="#__codelineno-49-5" id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="gp"># </span>nunchuk-mpd-client
</span><span id="__span-49-6"><a href="#__codelineno-49-6" id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="go">Connection successful</span>
</span><span id="__span-49-7"><a href="#__codelineno-49-7" id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="go">Quit</span>
</span><span id="__span-49-8"><a href="#__codelineno-49-8" id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="go">Connection terminated</span>
</span></code></pre></div>
<p>All this was pretty straightforward, wasn't it? <em>Meson</em> rocks!</p>
<p>Congratulations, you've reached the end of all our labs. Try to look back, and see how much experience you've gained in these last days.</p>
<h2 id="backup-and-restore"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.14</span> Backup and restore</h2>
<p><strong>TODO: git commit + bundle</strong></p>
<p><strong>TODO: add missing files and folders to tar xz</strong></p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-50-1"><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="s2">"</span><span class="nv">$BUILDROOT</span><span class="s2">/output/images/"</span>
</span><span id="__span-50-2"><a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="gp">$ </span>tar<span class="w"> </span>cfJv<span class="w"> </span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/appdev-images.tar.xz"</span><span class="w"> </span>*
</span></code></pre></div>
<h2 id="licensing"><span class="enumerate-headings-plugin enumerate-heading-plugin">24.15</span> Licensing</h2>
<p>This document is an extension to: <a href="https://bootlin.com/doc/training/embedded-linux-bbb/"><em>Embedded Linux System Development - Practical Labs - BeagleBone Black Variant</em></a>
 — © 2004-2023, <em>Bootlin</em> <a href="https://bootlin.com">https://bootlin.com/</a>, <a href="(https://creativecommons.org/licenses/by-sa/3.0/)"><code>CC-BY-SA-3.0</code></a> license.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.fac441b0.min.js"></script>
</body>
</html>