
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../virtualbox/" rel="prev"/>
<link href="../bootloader/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.3, mkdocs-material-9.1.11" name="generator"/>
<title>Building a cross-compile toolchain - Embedded Systems Linux Development Notes</title>
<link href="../../assets/stylesheets/main.85bb2934.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#building-a-cross-compile-toolchain">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Embedded Systems Linux Development Notes" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Embedded Systems Linux Development Notes">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Embedded Systems Linux Development Notes
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Building a cross-compile toolchain
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Embedded Systems Linux Development Notes" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Embedded Systems Linux Development Notes">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Embedded Systems Linux Development Notes
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Overview
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          QEMU variant
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          QEMU variant
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../virtualbox/">
        Host VM
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Building a cross-compile toolchain
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Building a cross-compile toolchain
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#objectives">
    Objectives
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#required-tools">
    Required tools
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#source-code">
    Source code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bootstrap">
    Bootstrap
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
    Configuration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#build">
    Build
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#backup-and-restore">
    Backup and restore
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-test">
    Quick test
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cleaning-up">
    Cleaning up
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#licensing">
    Licensing
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bootloader/">
        Bootloader - U-Boot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../kernel/">
        Linux Kernel
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tinysystem/">
        Tiny embedded system with BusyBox
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../hardware/">
        Accessing Hardware Devices
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../blockfs/">
        Block Filesystems
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../thirdparty/">
        Third-party libraries and apps
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../buildroot/">
        Buildroot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../appdev/">
        App - Development
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../debugging/">
        App - Remote debug
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../debootstrap/">
        debootstrap
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          BeagleBone Black variant
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          BeagleBone Black variant
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/virtualbox/">
        Host VM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/toolchain/">
        Building a cross-compile toolchain
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/bootloader/">
        Bootloader - U-Boot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/kernel/">
        Linux Kernel
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/tinysystem/">
        Tiny embedded system with BusyBox
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/hardware/">
        Accessing Hardware Devices
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/blockfs/">
        Block Filesystems
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/thirdparty/">
        Third-party libraries and apps
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/buildroot/">
        Buildroot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/integration/">
        System integration
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../bbb/appdev/">
        App - Development
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Knowledge Base
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Knowledge Base
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../kb/git-hash/">
        git commit hash expansion
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kb/menuconfig/">
        menuconfig
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../kb/processors/">
        Processors
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../copying/">
        Copying this document
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#objectives">
    Objectives
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#required-tools">
    Required tools
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#source-code">
    Source code
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bootstrap">
    Bootstrap
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
    Configuration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#build">
    Build
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#backup-and-restore">
    Backup and restore
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-test">
    Quick test
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cleaning-up">
    Cleaning up
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#licensing">
    Licensing
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="building-a-cross-compile-toolchain"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.</span> Building a cross-compile toolchain</h1>
<h2 id="objectives"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.1</span> Objectives</h2>
<p>After this lab, you will be able to:</p>
<ul>
<li>
<p>Configure the <em>crosstool-NG</em> tool.</p>
</li>
<li>
<p>Execute <em>crosstool-NG</em> and build up your own <em>cross-compiling toolchain</em>.</p>
</li>
</ul>
<h2 id="required-tools"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.2</span> Required tools</h2>
<ul>
<li>
<p>Ubuntu packages:</p>
<p><code>autoconf</code>
<code>bison</code>
<code>build-essential</code>
<code>flex</code>
<code>gawk</code>
<code>git</code>
<code>help2man</code>
<code>libncurses-dev</code>
<code>libtool-bin</code>
<code>qemu-user</code>
<code>texinfo</code>
<code>unzip</code>
<code>wget</code>
<code>xz-utils</code></p>
</li>
<li>
<p><a href="https://crosstool-ng.github.io/">crosstool-NG</a>, either from:</p>
<ul>
<li>
<p><a href="https://github.com/crosstool-ng/crosstool-ng"><em>GitHub</em> repository</a></p>
</li>
<li>
<p><a href="https://github.com/crosstool-ng/crosstool-ng/archive/7622b490a359f6cc6b212859b99d32020a8542e7.zip">Source code archive of commit <code>7622b490</code></a></p>
</li>
</ul>
</li>
</ul>
<h2 id="source-code"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.3</span> Source code</h2>
<p>First, install some packages required for compilation:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span>autoconf<span class="w"> </span>bison<span class="w"> </span>build-essential<span class="w"> </span>cpio<span class="w"> </span>flex<span class="w"> </span>gawk<span class="w"> </span>git<span class="w"> </span>help2man<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span>libncurses-dev<span class="w"> </span>libtool-bin<span class="w"> </span>texinfo<span class="w"> </span>unzip<span class="w"> </span>wget<span class="w"> </span>xz-utils
</span></code></pre></div>
<p>Enter the folder of this lab, that's going to become our main workspace folder:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="gp">$ </span><span class="nv">LAB_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/embedded-linux-qemu-labs/toolchain"</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAB_PATH</span>
</span></code></pre></div>
<p>You can now get <em>crosstool-NG</em> at the suggested version (<em>git</em> commit <code>7622b490</code>).</p>
<p>We're going to clone the <em>git</em> repository into the home folder, creating a new <em>branch</em> named after the <em>embedded-linux-qemu</em> tutorial just for convenience.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="gp">$ </span>git<span class="w"> </span>clone<span class="w"> </span><span class="s2">"https://github.com/crosstool-ng/crosstool-ng"</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>crosstool-ng/
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="gp">$ </span><span class="nv">label</span><span class="o">=</span><span class="s2">"7622b490"</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="gp">$ </span>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span>embedded-linux-qemu<span class="w"> </span><span class="si">${</span><span class="nv">label</span><span class="si">}</span>
</span></code></pre></div>
<p>Alternatively, you can directly unpack an archive of the suggested version. This is usually much faster than cloning a big <em>git</em> repository, despite losing all the features of a <em>git</em> repository.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="gp">$ </span><span class="nv">label</span><span class="o">=</span><span class="s2">"7622b490a359f6cc6b212859b99d32020a8542e7"</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="gp">$ </span>wget<span class="w"> </span><span class="s2">"https://github.com/crosstool-ng/crosstool-ng/archive/</span><span class="si">${</span><span class="nv">label</span><span class="si">}</span><span class="s2">.zip"</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="gp">$ </span>unzip<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">label</span><span class="si">}</span><span class="s2">.zip"</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="gp">$ </span>mv<span class="w"> </span>crosstool-ng*/<span class="w"> </span>crosstool-ng
</span></code></pre></div>
<blockquote>
<p>See: <a href="../../kb/git-hash/"><em>git commit</em> hash expansion</a></p>
</blockquote>
<h2 id="bootstrap"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.4</span> Bootstrap</h2>
<p>Now that the source code is available, its content requires some initial setup to become available. The local <code>bootstrap</code> executable takes care of this initial setup.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAB_PATH</span>/crosstool-ng/
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="gp">$ </span>./bootstrap
</span></code></pre></div>
<p>We're going to compile and install everything locally, so you must
<em>configure</em> the code base for that, via the canonical <code>configure</code> executable.<br/>
To improve compile time from now on, let's provide the
<a href="../../kb/processors/">number of processors</a> to <code>make</code>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">MAKEFLAGS</span><span class="o">=</span>-j<span class="k">$(</span>nproc<span class="k">)</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="gp">$ </span>./configure<span class="w"> </span>--enable-local
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="gp">$ </span>make
</span></code></pre></div>
<p>From now on, the generated <code>ct-ng</code> executable is our main command for the toolchain generation.</p>
<h2 id="configuration"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.5</span> Configuration</h2>
<p>A single installation of <em>crosstool-NG</em> allows to produce as many toolchains as you want, for different architectures, with different C libraries and different versions of the various components.</p>
<p><em>crosstool-NG</em> comes with a set of ready-made configuration files for various typical setups, called <em>samples</em>. They can be listed by calling the <code>list-samples</code> command.</p>
<p>We're going to load the sample for the <em>ARM Cortex A9</em> processor, so let's filter the results:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="gp">$ </span>./ct-ng<span class="w"> </span>list-samples<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>a9
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="hll"><span class="go">[L..X]   arm-cortexa9_neon-linux-gnueabihf</span>
</span></span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="go">[L..X]   x86_64-w64-mingw32,arm-cortexa9_neon-linux-gnueabihf</span>
</span></code></pre></div>
<p>Our target sample is <code>arm-cortexa9_neon-linux-gnueabihf</code>, so let's configure for it, generating a <code>.config</code> file:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="gp">$ </span>./ct-ng<span class="w"> </span>arm-cortexa9_neon-linux-gnueabihf
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="go">    ...</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="go">Now configured for "arm-cortexa9_neon-linux-gnueabihf"</span>
</span></code></pre></div>
<p>We can refine the configuration via a useful user interface called <code>menuconfig</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="gp">$ </span>./ct-ng<span class="w"> </span>menuconfig
</span></code></pre></div>
<blockquote>
<p>See: <a href="../../kb/menuconfig/"><code>menuconfig</code></a></p>
</blockquote>
<p>In <code>Debug facilities</code>:</p>
<ul>
<li>Remove all the options here.
  Some debugging tools can be provided in the toolchain, but they can also be built by filesystem building tools.<br/>
<strong>Do this before anything else</strong>: removing features often messes up elsewhere (<em>IPv6</em> and <em>WCHAR</em> for example)!</li>
</ul>
<p>In <code>Path and misc options</code>:</p>
<ul>
<li>
<p>To resume a failed compilation, enable the following options.
  Without these, you have to restart the whole compilation from scratch, which usually takes a long time.</p>
<ul>
<li>Enable <code>Debug crosstool-NG</code> (<code>DEBUG_CT</code>)</li>
<li>Enable <code>Save intermediate steps</code> (<code>CT_DEBUG_CT_SAVE_STEPS</code>)</li>
<li>Enable <code>gzip saved states</code> (<code>CT_DEBUG_CT_SAVE_STEPS_GZIP</code>)</li>
<li>Enable <code>Interactive shell on failed commands</code> (<code>CT_DEBUG_INTERACTIVE</code>)</li>
</ul>
</li>
<li>
<p>Set <code>Number of parallel jobs</code> (<code>CT_PARALLEL_JOBS</code>) = <a href="../../kb/processors/">number of processors</a>.<br/>
  This improves the performance of the building pipeline.</p>
</li>
<li>
<p>Set <code>Maximum log level to see:</code> (<code>LOG_DEBUG</code>) = <code>DEBUG</code>.<br/>
  This way we can have more details on what happened during the build in case something went wrong.<br/>
  This isn't strictly required, and might produce too many messages. I'm keeping it to <code>EXTRA</code> actually.</p>
</li>
</ul>
<p>In <code>Toolchain options</code>:</p>
<ul>
<li>
<p>Set <code>Tuple's vendor string</code> (<code>TARGET_VENDOR</code>) = <code>training</code>.</p>
</li>
<li>
<p>Set <code>Tuple's alias</code> (<code>TARGET_ALIAS</code>) = <code>arm-linux</code>.<br/>
  This way, we will be able to use the compiler as <code>arm-linux-gcc</code> instead of <br/>
<code>arm-training-linux-uclibcgnueabihf-gcc</code>, which is much longer to type.</p>
</li>
</ul>
<p>In <code>Operating System</code>:</p>
<ul>
<li>Set <code>Version of linux</code> = <code>5.15.x</code> version that is proposed.<br/>
  We choose this version because this matches the version of the kernel we will run on the board.
  At least, the version of the kernel headers are not more recent (which might be incompatible).</li>
</ul>
<p>In <code>C-library</code>:</p>
<ul>
<li>
<p>Set <code>C library</code> (<code>LIBC_UCLIBC_NG</code>) = <code>uClibc-ng</code>.</p>
</li>
<li>
<p>Keep the default version that is proposed.</p>
</li>
<li>
<p>Enable <code>Add support for IPv6</code> (<code>LIBC_UCLIBC_IPV6</code>).<br/>
  That's needed to use the toolchain in <em>Buildroot</em>, which only accepts toolchains with IPv6 support.</p>
</li>
<li>
<p>Enable <code>Add support for WCHAR</code> (<code>LIBC_UCLIBC_WCHAR</code>).</p>
</li>
<li>
<p>Enable <code>Support stack smashing protection (SSP)</code> (<code>LIBC_UCLIBC_HAS_SSP</code>).</p>
</li>
</ul>
<p>In <code>C compiler</code>:</p>
<ul>
<li>
<p>Set <code>Version of gcc</code> = <code>11.3.0</code>.<br/>
  We need to stick to <em>GCC 11.x</em>, because <em>Buildroot 2022.02</em> (which we are going to use later) doesn't support <em>GCC 12.x</em> toolchains yet (released after).</p>
</li>
<li>
<p>Enable <code>C++</code> (<code>CC_LANG_CXX</code>).</p>
</li>
</ul>
<blockquote>
<p><strong>Do cross-check everything now!</strong><br/>
It can happen that, when changing feature states, some overlooked dependency chains mess up with the configuration!<br/>
For example:</p>
<p><em>defconfig</em> <code>arm-cortex_a8-linux-gnueabi</code> ⇒ <code>DEBUG_GDB=y</code> ⇒ <code>LIBC_UCLIBC_IPV6=y</code></p>
<p>So, it looked like <em>IPv6</em> support was ok.<br/>
But, after removing <code>gdb</code> (<code>DEBUG_GDB=n</code>) from the <code>Debug facilities</code>:</p>
<p><code>DEBUG_GDB=n</code> ⇒ <code>LIBC_UCLIBC_IPV6=n</code></p>
<p>We could have forced <code>LIBC_UCLIBC_IPV6=y</code> by pressing <span class="keys"><kbd class="key-y">Y</kbd></span> even if it looked automatically enabled (marked with <code>-*-</code>), but I've found no easy visual feedback to ensure that.<br/>
So, cross-checking before leaving is strongly encouraged!
I've lost a lot of time re-building the toolchain because of overlooking these naiveities, just because <em>Buildroot</em> slammed errors in my face so late!</p>
</blockquote>
<p>You can now <code>&lt;Save&gt;</code> this configuration to the default <code>.config</code> file.</p>
<p>It's best to save a back-up copy as well:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="gp">$ </span>cp<span class="w"> </span>.config<span class="w"> </span>../crosstool-ng.config
</span></code></pre></div>
<p>You'd better also create the <code>~/src/</code> folder, where <em>crosstool-NG</em> stores the downloaded tarballs by default.
It's handy to store them in case of any errors or cleanup, to avoid repeated downloads.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span>~/src/
</span></code></pre></div>
<h2 id="build"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.6</span> Build</h2>
<p>Run the <code>build</code> command:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="gp">$ </span>./ct-ng<span class="w"> </span>build
</span></code></pre></div>
<p>The build takes quite a long time to perform — a clean build took around 50 minutes on an <em>Intel i7 7700</em> laptop with 4 cores, of course within the <em>Lubuntu</em> VM.<br/>
It requires a stable internet connection.</p>
<p>In case of any errors, the interactive error shell can help to resume compilation from the failed step.
Possible errors might occur because of an unstable connection, or because the VM was provided a small amount of RAM (suggested ≥ 4 GB).</p>
<p>The toolchain is installed by default under <code>~/x-tools/</code>.<br/>
In our example: <code>~/x-tools/arm-training-linux-uclibcgnueabihf/</code>.<br/>
That's something you could have changed in the configuration of <em>crosstool-NG</em>.</p>
<h2 id="backup-and-restore"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.7</span> Backup and restore</h2>
<p>It's best to save an archive of the generated toolchain, because building times can be very long.
Let's archive it into the folder of the current lab.</p>
<p>We're going to use <code>cpio</code> instead of the common <code>tar</code> to preserve <em>symlinks</em> as they are within the filesystem.</p>
<blockquote>
<p>FYI: <a href="https://linuxconfig.org/how-to-create-and-extract-cpio-archives-on-linux-examples">https://linuxconfig.org/how-to-create-and-extract-cpio-archives-on-linux-examples</a></p>
</blockquote>
<div class="language-console highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="gp">$ </span><span class="nb">pushd</span><span class="w"> </span>.
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="gp">$ </span><span class="nv">TC_NAME</span><span class="o">=</span><span class="s2">"arm-training-linux-uclibcgnueabihf"</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="gp">$ </span><span class="nv">TC_BASE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/x-tools/</span><span class="nv">$TC_NAME</span><span class="s2">"</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$TC_BASE</span>/..
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="gp">$ </span>find<span class="w"> </span>.<span class="w"> </span>-depth<span class="w"> </span>-print0<span class="w"> </span><span class="p">|</span><span class="w"> </span>cpio<span class="w"> </span>-ocv0<span class="w"> </span><span class="p">|</span><span class="w"> </span>xz<span class="w"> </span>&gt;<span class="w"> </span><span class="s2">"</span><span class="nv">$LAB_PATH</span><span class="s2">/</span><span class="si">${</span><span class="nv">TC_NAME</span><span class="si">}</span><span class="s2">.cpio.xz"</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="gp">$ </span><span class="nb">popd</span>
</span></code></pre></div>
<blockquote>
<p><code>pushd</code>/<code>popd</code> allow to push/pop the current directory (<code>pwd</code>) against the directory stack (<code>dirs</code>).</p>
</blockquote>
<p>To restore it under <code>~/x-tools/</code>, just unpack the backup archive there:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAB_PATH</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="gp">$ </span>sudo<span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span><span class="nv">$TC_BASE</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="gp">$ </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/x-tools/"</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="gp">$ </span>xzcat<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">TC_NAME</span><span class="si">}</span><span class="s2">.cpio.xz"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cpio<span class="w"> </span>-iduv<span class="w"> </span>-D<span class="w"> </span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/x-tools/"</span>
</span></code></pre></div>
<h2 id="quick-test"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.8</span> Quick test</h2>
<p>The toolchain can be called by adding the generated <code>bin</code> folder to your <code>PATH</code> environment variable.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$TC_BASE</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>
</span></code></pre></div>
<p>You can now compile the simple <code>hello.c</code> with our new shiny <code>arm-linux-gcc</code> shorthand:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="nv">$LAB_PATH</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="gp">$ </span>arm-linux-gcc<span class="w"> </span>-o<span class="w"> </span>hello<span class="w"> </span>hello.c
</span></code></pre></div>
<p>You can use the <code>file</code> command on your binary to make sure it has correctly been compiled for the ARM architecture.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="gp">$ </span>file<span class="w"> </span>hello
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="go">hello: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, not stripped</span>
</span></code></pre></div>
<p>Did you know that you can still execute this binary from your <em>x86</em> host? To do this, install the <em>QEMU user</em> emulator, which just emulates target instruction sets, not an entire system with devices.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>qemu-user
</span></code></pre></div>
<p>Try to run <em>QEMU</em> with the <code>hello</code> executable generated with our toolchain:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="gp">$ </span>qemu-arm<span class="w"> </span>hello
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="go">qemu-arm: Could not open '/lib/ld-uClibc.so.0': No such file or directory</span>
</span></code></pre></div>
<p>What's happening is that <code>qemu-arm</code> is missing the shared C library (compiled for ARM) that
this binary uses. Let's find it in our newly compiled toolchain:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="gp">$ </span>find<span class="w"> </span>~/x-tools/<span class="w"> </span>-name<span class="w"> </span>ld-uClibc.so.0
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="go">/home/me/x-tools/arm-training-linux-uclibcgnueabihf/arm-training-linux-uclibcgnueabihf/sysroot/lib/ld-uClibc.so.0</span>
</span></code></pre></div>
<p>We can now use the <code>-L</code> option of <code>qemu-arm</code> to let it know where shared libraries are:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="gp">$ </span>qemu-arm<span class="w"> </span>-L<span class="w"> </span><span class="s2">"</span><span class="nv">$TC_BASE</span><span class="s2">/</span><span class="nv">$TC_NAME</span><span class="s2">/sysroot/"</span><span class="w"> </span>hello
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="go">Hello world!</span>
</span></code></pre></div>
<h2 id="cleaning-up"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.9</span> Cleaning up</h2>
<p>To save about 11 GB of storage space, run the <code>clean</code> command in the <em>crosstool-NG</em> source directory.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="gp">$ </span>./ct-ng<span class="w"> </span>clean
</span></code></pre></div>
<p>This removes the source code of the toolchain components, as well as all the generated files that are now useless, since the toolchain has been installed in <code>~/x-tools</code>, and we made a back-up archive.</p>
<p>Do this only if you have limited storage space.
In case you made a mistake in the toolchain configuration, you may need to run <em>crosstool-NG</em> again to rebuild everything form scratch — keeping generated files would save a significant amount of time.</p>
<h2 id="licensing"><span class="enumerate-headings-plugin enumerate-heading-plugin">3.10</span> Licensing</h2>
<p>This document is an extension to: <a href="https://bootlin.com/doc/training/embedded-linux-qemu/"><em>Embedded Linux System Development - Practical Labs - QEMU Variant</em></a>
 — © 2004-2023, <em>Bootlin</em> <a href="https://bootlin.com">https://bootlin.com/</a>, <a href="(https://creativecommons.org/licenses/by-sa/3.0/)"><code>CC-BY-SA-3.0</code></a> license.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.fac441b0.min.js"></script>
</body>
</html>